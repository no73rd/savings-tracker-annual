<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>تسجيل دخول وتحويش</title>
<style>
  body { font-family: 'Cairo', sans-serif; background:#eef; padding: 20px; }
  .container { max-width: 400px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
  input, select, button { width: 100%; margin: 8px 0; padding: 8px; }
  button { cursor: pointer; background: #00695c; color: white; border: none; }
  button:hover { background: #004d40; }
  .hidden { display: none; }
  .link { color: #00695c; cursor: pointer; text-align: center; margin-top: 10px; }
</style>
</head>
<body>

<div class="container" id="loginSection">
  <h2>تسجيل الدخول</h2>
  <form id="loginForm">
    <input type="text" id="loginUsername" placeholder="اسم المستخدم" required />
    <input type="password" id="loginPassword" placeholder="كلمة المرور" required />
    <button type="submit">دخول</button>
  </form>
  <div class="link" id="toRegister">ليس لديك حساب؟ سجل هنا</div>
</div>

<div class="container hidden" id="registerSection">
  <h2>إنشاء حساب جديد</h2>
  <form id="registerForm">
    <input type="text" id="registerUsername" placeholder="اسم المستخدم" required />
    <input type="password" id="registerPassword" placeholder="كلمة المرور" required />
    <button type="submit">تسجيل</button>
  </form>
  <div class="link" id="toLogin">لديك حساب؟ سجل الدخول</div>
</div>

<script>
  // التبديل بين التسجيل والدخول
  const loginSection = document.getElementById('loginSection');
  const registerSection = document.getElementById('registerSection');
  const toRegister = document.getElementById('toRegister');
  const toLogin = document.getElementById('toLogin');

  toRegister.onclick = () => {
    loginSection.classList.add('hidden');
    registerSection.classList.remove('hidden');
  };
  toLogin.onclick = () => {
    registerSection.classList.add('hidden');
    loginSection.classList.remove('hidden');
  };

  // حفظ واسترجاع المستخدمين من localStorage
  function getUsers() {
    const users = localStorage.getItem('users');
    return users ? JSON.parse(users) : {};
  }
  function saveUsers(users) {
    localStorage.setItem('users', JSON.stringify(users));
  }
  function hashPassword(pwd) {
    return btoa(pwd);
  }

  // تسجيل حساب جديد
  document.getElementById('registerForm').addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('registerUsername').value.trim();
    const password = document.getElementById('registerPassword').value;
    if (!username || !password) {
      alert('يرجى ملء جميع الحقول');
      return;
    }
    const users = getUsers();
    if (users[username]) {
      alert('اسم المستخدم موجود بالفعل');
      return;
    }
    users[username] = { password: hashPassword(password), savingsData: [] };
    saveUsers(users);
    alert('تم إنشاء الحساب بنجاح، يمكنك تسجيل الدخول الآن');
    registerSection.classList.add('hidden');
    loginSection.classList.remove('hidden');
    // تنظيف الحقول
    document.getElementById('registerForm').reset();
  });

  // تسجيل الدخول
  document.getElementById('loginForm').addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value;
    const users = getUsers();
    if (!users[username] || users[username].password !== hashPassword(password)) {
      alert('اسم المستخدم أو كلمة المرور غير صحيحة');
      return;
    }
    alert('تم تسجيل الدخول بنجاح! (هنا تقدر تحوّل للداشبورد)');
    document.getElementById('loginForm').reset();
  });
</script>

</body>
</html>
